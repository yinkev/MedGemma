# Handoff (2026-01-17T09:40:44-0800)

## State
- Project directory: `/Users/kyin/Projects/MedASR`
- Remote to publish to: `git@github.com:yinkev/MedGemma.git`
- Repo was not previously a git repo; git init + first push is pending.

## What Changed Since Prior "All Tasks Complete" Snapshot

### MedASR CTC+KenLM Decoder Fixes (Critical)
- Fixed a runtime error where pyctcdecode rejected logits `(T, 512)` because labels length didn’t match.
- Enforced MedASR-specific invariants:
  - Trim decoder labels to `model.config.vocab_size` (MedASR config = 512; tokenizer vocab is larger).
  - Blank label must be `""` (MedASR tokenizer uses `<epsilon>` at id 0).
  - SentencePiece normalization for LM decode: for each non-special token, transform to `"▁" + piece.replace("▁", "#")`.
  - Decoded text restoration: remove spurious spaces, convert `#` -> real spaces, strip `</s>`.
  - Punctuation mapping: `{period}` -> `.`, `{comma}` -> `,`, `{colon}` -> `:`, `{new paragraph}` -> blank line.
- Files:
  - `src/medasr_local/asr/lm.py`
  - `src/medasr_local/asr/decode.py`

### Docs Updates
- Updated `README.md` to clarify:
  - "Live" assistant is chunked (not true streaming captions).
  - MedGemma 1.5 model id is vision-capable, but current integration is text-only.
  - Added a short roadmap section (streaming captions, on-demand assist, on-demand screenshot assist, diarization).
- Updated `workflows/Install-Quick-Action.md` to match the scripted installer path.

## Current Known Gaps (Intentional)
- MedGemma is used via `AutoModelForCausalLM` + `AutoTokenizer` (text-only prompts). No screenshot path wired.
- No true streaming captions (stable prefix + editable tail). Current live assistant does overlapped chunk transcription.
- No diarization.

## Suggested Next Session
- Initialize git, add remote, commit, push to `main`.
- Decide whether to commit `native/audiocapture` binary or build it in `setup.sh` only.
- If building spec next: define CLI toggles for streaming/assist/screen + capture logging policies.

## Quick Smoke Commands
- `./setup.sh`
- `bin/medasr-transcribe test_audio.wav -o out --txt --json`
- `bin/medasr-assistant` (mic)
- `bin/medasr-ask out.txt "What is the diagnosis?"`
